<!doctype html>
<html itemscope itemtype="http://schema.org/Organization" lang="en">
  <head>
    <base href="/foreman-rex/">
    
    
    

    
    
    
  <title> :: Plugin Manuals</title>

  <script type="text/javascript" src="/foreman-rex/static/js/jquery.js"></script>
  <script type="text/javascript" src="/foreman-rex/static/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/foreman-rex/static/js/jquery-ui-1.9.2.custom.min.js"></script>
  <script type="text/javascript" src="/foreman-rex/static/js/jquery.tocify.min.js"></script>
  <script type="text/javascript" src="/foreman-rex/static/js/scroll.js"></script>

  <link rel="stylesheet" media="all" href="/foreman-rex/static/css/bootstrap.min.css"/>
  <link rel="stylesheet" media="all" href="/foreman-rex/static/css/bootstrap-responsive.min.css"/>
  <link rel="stylesheet" media="all" href="/foreman-rex/static/css/jquery.tocify.css"/>
  <link rel="stylesheet" media="all" href="/foreman-rex/static/css/syntax.css" />
  <link rel="stylesheet" media="all" href="/foreman-rex/static/css/style.css"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0;" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
  <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
          <div class="container">
              <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <img alt="Foreman" class="logo" src="/foreman-rex/static/images/foreman.png" />
              <div class="brand">
                <a  href="/foreman-rex/">Foreman</a>
                <a class="subtitle" href="/foreman-rex/">Remote Execution</a>
              </div>
              <div class="nav-collapse collapse">
                <ul class="nav">
                  <li><a href="/foreman-rex/">About</a></li>
                  <li><a href="/foreman-rex/design/">Design</a></li>
                </ul>
              </div>
          </div>
      </div>
  </div>
<script>
$(function(){
  $('.nav > li a[href="'+window.location.pathname+'"]').parents('.nav > li').addClass('active')
})
</script>


  <div id="main">
    <div id="content" class="container">
      <div class="row">
        <div id="toc" class="span3">
        </div>
        <div id="doc" class="offset3 span9">
          <h1 id="remote-execution-technology">Remote Execution Technology</h1>

<h2 id="user-stories">User Stories</h2>

<ul>
<li><p>As a user I want to run commands in parallel across large number of
hosts</p></li>
<li><p>As a user I want to run commands on a host in a different network
segment (the host doesn&#39;t see the Foreman server/the Foreman server
doesn&#39;t see the host directly)</p></li>
<li><p>As a user I want to manage a host without installing an agent on it
(just plain old ssh)</p></li>
<li><p>As a community user I want to already existing remote execution
technologies in combination with the Foreman</p></li>
</ul>

<h2 id="design">Design</h2>

<h3 id="ssh-single-host-push">Ssh Single Host Push</h3>

<p><img src='/foreman-rex///images/plantuml/16aebbe8eb0ca9ed26fbd3ea2a7cb704.png'></p>

<p>UserCommand:</p>

<ul>
<li>hosts: [host.example.com]</li>
<li>template: install-packages-ssh</li>
<li>input: { packages: [&#39;vim-X11&#39;] }</li>
</ul>

<p>ProxyCommand:</p>

<ul>
<li>host: host.example.com</li>
<li>provider: ssh</li>
<li>input: &quot;yum install -y vim-X11&quot;</li>
</ul>

<p>SshCommand:</p>

<ul>
<li>host: host.example.com</li>
<li>input: &quot;yum install -y vim-X11&quot;</li>
</ul>

<p>ProgressReport[1, Running]:</p>

<ul>
<li>output: &quot;Resolving depednencies&quot;</li>
</ul>

<p>ProgressReport[2, Running]:</p>

<ul>
<li>output: &quot;installing libXt&quot;</li>
</ul>

<p>AccumulatedProgressReport[1, Running]:</p>

<ul>
<li>output: { stdout: &quot;Resolving depednencies\ninstalling libXt&quot; }</li>
</ul>

<p>ProgressReport[3, Running]:</p>

<ul>
<li>output: &quot;installing vim-X11&quot;</li>
</ul>

<p>ProgressReport[4, Finished]:</p>

<ul>
<li>output: &quot;operation finished successfully&quot;</li>
<li>exit_code: 0</li>
</ul>

<p>AccumulatedProgressReport[2, Finished]:</p>

<ul>
<li>output: { stdout: &quot;installing vim-X11\noperation finished successfully&quot;, exit_code: 0 }</li>
<li>success: true</li>
</ul>

<h3 id="ssh-single-host-pull">Ssh Single Host Pull</h3>

<p><img src='/foreman-rex///images/plantuml/40c71a2b081db9c25ff88fda3fb8485d.png'></p>

<p>UserCommand:</p>

<ul>
<li>hosts: [host.example.com]</li>
<li>template: install-packages-ssh</li>
<li>input: { packages: [&#39;vim-X11&#39;] }</li>
</ul>

<p>ProxyCommand:</p>

<ul>
<li>host: host.example.com</li>
<li>provider: ssh</li>
<li>input: &quot;yum install -y vim-X11&quot;</li>
</ul>

<p>Script:</p>

<ul>
<li>input: &quot;yum install -y vim-X11&quot;</li>
</ul>

<p>ProgressReport[1, Running]:</p>

<ul>
<li>output: &quot;Resolving depednencies&quot;</li>
</ul>

<p>ProgressReport[2, Running]:</p>

<ul>
<li>output: &quot;installing libXt&quot;</li>
</ul>

<p>AccumulatedProgressReport[1, Running]:</p>

<ul>
<li>output: { stdout: &quot;Resolving depednencies\ninstalling libXt&quot; }</li>
</ul>

<p>ProgressReport[3, Running]:</p>

<ul>
<li>output: &quot;installing vim-X11&quot;</li>
</ul>

<p>ProgressReport[4, Finished]:</p>

<ul>
<li>output: &quot;operation finished successfully&quot;</li>
<li>exit_code: 0</li>
</ul>

<p>AccumulatedProgressReport[2, Finished]:</p>

<ul>
<li>output: { stdout: &quot;Resolving depednencies\ninstalling libXt&quot;, exit_code: 0 }</li>
<li>success: true</li>
</ul>

<h3 id="ssh-multi-host">Ssh Multi Host</h3>

<p><img src='/foreman-rex///images/plantuml/df6507a5cb7e9f9fe4203669e758a918.png'></p>

<p>UserCommand:</p>

<ul>
<li>hosts: *.example.com</li>
<li>template: install-packages-ssh</li>
<li>input: { packages: [&#39;vim-X11&#39;] }</li>
</ul>

<p>ProxyCommand[host1]:</p>

<ul>
<li>host: host-1.example.com</li>
<li>provider: ssh</li>
<li>input: &quot;yum install -y vim-X11&quot;</li>
</ul>

<p>ProxyCommand[host2]:</p>

<ul>
<li>host: host-2.example.com</li>
<li>provider: ssh</li>
<li>input: &quot;yum install -y vim-X11&quot;</li>
</ul>

<div class=" alert alert-info">
  <p><strong>Note</strong> </p>

<p>we might want to optimize the communication between server and
the proxy (sending collection of ProxyCommands in bulk, as well as
the AccumulatedProgerssReports). That would could also be utilized
by the Ansible implementation, where there might be optimization
on the invoking the ansible commands at once (the same might apply
to mcollective). On the other hand, this is more an optimization,
not required to be implemented from the day one: but it&#39;s good to have
this in mind</p>

</div>

<h3 id="mcollective-single-host">MCollective Single Host</h3>

<p><img src='/foreman-rex///images/plantuml/3d6f85d2d931ded5ecae64f2bc89c11a.png'></p>

<p>UserCommand:</p>

<ul>
<li>hosts: [host.example.com]</li>
<li>template: install-packages-mco</li>
<li>input: { packages: [&#39;vim-X11&#39;] }</li>
</ul>

<p>ProxyCommand:</p>

<ul>
<li>host: host.example.com</li>
<li>provider: mcollective</li>
<li>input: { agent: package, args: { package =&gt; &#39;vim-X11&#39; } }</li>
</ul>

<p>MCOCommand:</p>

<ul>
<li>host: host.example.com</li>
<li>input: { agent: package, args: { package =&gt; &#39;vim-X11&#39; } }</li>
</ul>

<p>ProgressReport[Finished]:</p>

<ul>
<li>output: [ {&quot;name&quot;:&quot;vim-X11&quot;,&quot;tries&quot;:1,&quot;version&quot;:&quot;7.4.160-1&quot;,&quot;status&quot;:0,&quot;release&quot;:&quot;1.el7&quot;},
          {&quot;name&quot;:&quot;libXt&quot;,&quot;tries&quot;:1,&quot;version&quot;:&quot;1.1.4-6&quot;,&quot;status&quot;:0,&quot;release&quot;:&quot;1.el7&quot;} ]</li>
</ul>

<p>AccumulatedProgressReport[Finished]:</p>

<ul>
<li>output: [ {&quot;name&quot;:&quot;vim-X11&quot;,&quot;tries&quot;:1,&quot;version&quot;:&quot;7.4.160-1&quot;,&quot;status&quot;:0,&quot;release&quot;:&quot;1.el7&quot;},
          {&quot;name&quot;:&quot;libXt&quot;,&quot;tries&quot;:1,&quot;version&quot;:&quot;1.1.4-6&quot;,&quot;status&quot;:0,&quot;release&quot;:&quot;1.el7&quot;} ]</li>
<li>success: true</li>
</ul>

<h3 id="ansible-single-host">Ansible Single Host</h3>

<p><img src='/foreman-rex///images/plantuml/cb5c68d0f0ff412347978b498e5673c2.png'></p>

<p>UserCommand:</p>

<ul>
<li>hosts: [host.example.com]</li>
<li>template: install-packages-ansible</li>
<li>input: { packages: [&#39;vim-X11&#39;] }</li>
</ul>

<p>ProxyCommand:</p>

<ul>
<li>host: host.example.com</li>
<li>provider: ansible</li>
<li>input: { module: yum, args: { name: &#39;vim-X11&#39;, state: installed } }</li>
</ul>

<p>AnsibleCommand:</p>

<ul>
<li>host: host.example.com</li>
<li>provider: ansible</li>
<li>input: { module: yum, args: { name: &#39;vim-X11&#39;, state: installed } }</li>
</ul>

<p>ProgressReport[Finished]:</p>

<ul>
<li>output: { changed: true,
          rc: 0,
          results: [&quot;Resolving depednencies\ninstalling libXt\ninstalling vim-X11\noperation finished successfully&quot;] }</li>
</ul>

<p>AccumulatedProgressReport[Finished]:</p>

<ul>
<li>output: { changed: true,
          rc: 0,
          results: [&quot;Resolving depednencies\ninstalling libXt\ninstalling vim-X11\noperation finished successfully&quot;] }</li>
<li>success: true</li>
</ul>

<h1 id="command-preparation">Command Preparation</h1>

<h2 id="user-stories">User Stories</h2>

<ul>
<li><p>?As a user I want to be able to specify default number of tries per command. # Command preparation?</p></li>
<li><p>?As a user I want to be able to specify default retry interval per command. # Command preparation?</p></li>
<li><p>?As a user I want to be able to specify default splay time per command. # Command preparation?</p></li>
<li><p>?As a user I want to setup default timeout per command. # Command preparation?</p></li>
</ul>

<h2 id="design">Design</h2>

<h1 id="command-invocation">Command Invocation</h1>

<h2 id="user-stories">User Stories</h2>

<ul>
<li><p>As a user when I plan a new CommandExecution I want to use an existing bookmark for specifying target hosts</p></li>
<li><p>As a user when I plan a new CommandExecution I want to use custom scoped search syntax for specifying target hosts</p></li>
<li><p>As a user when I plan a new CommandExecution I want to target single host</p></li>
<li><p>As a user when I plan a new CommandExecution I want to be able to evaluate a search query to target host immediately and store this list of targets even if command is planed in future</p></li>
<li><p>As a user when I plan a new CommandExecution I want to be able to evaluate a search query just before execution starts, if it&#39;s recurring I want new evaluation before every start</p></li>
<li><p>As a user when I plan a new CommandExecution I want planning functionality exposed by API and available in hammer</p></li>
<li><p>As a user I want to reuse targets of existing CommandExecution</p></li>
<li><p>As a user I want to have UI to add specific hosts to bookmarks so I don&#39;t have to specify scoped search for it (like fqdn = a or id = 1) [low priority]</p></li>
<li><p>As a user when I plan a new CommandExecution I want to see a warning based on status of targeted hosts (unavailable/not checking in)</p></li>
<li><p>As a user I want to be able to override default values like (number of tries, retry interval, splay time, ...) when I plan an execution of command.</p></li>
<li><p>As a user I want to be able to specify infinite number of tries (until success/cancel) when I plan an execution of command.</p></li>
<li><p>As a user I want to set timeout when I plan an execution of a command.</p></li>
<li><p>As a user I want to override default timeout when I plan an execution of command.</p></li>
</ul>

<h2 id="scenarios">Scenarios</h2>

<p>[ convert this to text descriptions ]</p>

<ul>
<li><p>As a user to plan a command I want to: 
input a job name
select targets (based on bookmarks, explicit host selection, custom query)
select job templates that can be used for this job name and targets (host is responsible to pick the one from the list)
fill in inputs for the selected job templates</p></li>
<li><p>As a user I want a link in host detail page to execute a job on displayed host which pre-fills the target in command invocation form</p></li>
<li><p>As a user I want a link in host list page that redirects me to command invocation page where I can plan job execution for targets I saw on host list page</p></li>
</ul>

<h2 id="design">Design</h2>

<p>Class diagram of Foreman classes</p>

<p><img src='/foreman-rex///images/plantuml/617c0bfb6db9b4ac52dcc580798d1d9d.png'></p>

<p>Query is copied to Target, we don&#39;t want to propagate any later
changes to Bookmark to already planned job executions.</p>

<p>We can store link to original bookmark to be able to
compare changes later.</p>

<p>For JobExecution we forbid later editing of Targeting.</p>

<h1 id="command-execution">Command Execution</h1>

<h2 id="user-stories">User Stories</h2>

<ul>
<li><p>As a user I want to be able to cancel command which hasn&#39;t been started yet.</p></li>
<li><p>As a user I want to be able to cancel command which is in progress. # some providers might not support this? therefore next user stories</p></li>
<li><p>As a developer I want to specify whether cancellation of running commands is possible.</p></li>
<li><p>As a user I want to see if I&#39;m able to cancel the command.</p></li>
<li><p>As a user I want job execution to fail after timeout limit.</p></li>
</ul>

<h2 id="design">Design</h2>

<p>Class diagram of Foreman classes</p>

<p><img src='/foreman-rex///images/plantuml/a2cd4a7662164d414e8f0e4b6fd280d8.png'></p>

<p>JobExecution will be probably later replaced by Scheduler that
will schedule ProxyCommands (could be responsible for batch jobs,
retrying on failure, timeouts)</p>

<p>We should take facts from Foreman rather gather them during runtime (different result than expected when planning, performance)</p>

<h2 id="open-questions">Open questions</h2>

<h1 id="reporting">Reporting</h1>

<h2 id="user-stories">User Stories</h2>

<h2 id="design">Design</h2>

<h1 id="scheduling">Scheduling</h1>

<h2 id="user-stories">User Stories</h2>

<h2 id="design">Design</h2>

<h1 id="katello-workflow-integration">Katello Workflow Integration</h1>

<h2 id="user-stories">User Stories</h2>

<h2 id="design">Design</h2>

<h1 id="security">Security</h1>

<h2 id="user-stories">User Stories</h2>

<h2 id="design">Design</h2>

<h1 id="orchestration">Orchestration</h1>

<h2 id="user-stories">User Stories</h2>

<h2 id="design">Design</h2>

        </div>
      </div>
    </div>
  </div>

<script type="text/javascript">
  $(function() {
    //Calls the tocify method on your HTML div.
    $("#toc").tocify({context: '#doc', scrollTo: '60', selectors: "h1,h2,h3"});
  });
</script>

<div class="footer">
  <div class="container">
    <p>This web site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_GB">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.  Source available: <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/theforeman/theforeman.org" rel="dct:source">github/theforeman/theforeman.org</a>.</p>
		<a href="https://plus.google.com/102496134326414788199" rel="publisher">Google+ community</a>
  </div>
</div>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2134730-5']);
  _gaq.push(['_trackPageview']);

  (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</body>
</html>

